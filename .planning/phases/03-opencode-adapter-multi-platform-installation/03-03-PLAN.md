---
phase: 03-opencode-adapter-multi-platform-installation
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/platform/install-adapter.ts
autonomous: true

must_haves:
  truths:
    - "getInstallPaths() accepts platform parameter"
    - "Paths returned are correct for both claude-code and opencode platforms"
    - "OpenCode paths use command/gsd structure (singular)"
  artifacts:
    - path: "src/platform/install-adapter.ts"
      provides: "Platform-aware install path resolution"
      exports: ["getInstallPaths"]
      contains: "opencode"
  key_links:
    - from: "src/platform/install-adapter.ts"
      to: "src/platform/paths.ts"
      via: "ClaudeCodePaths and OpenCodePaths import"
      pattern: "import.*(ClaudeCodePaths|OpenCodePaths)"
---

<objective>
Update install-adapter to support multi-platform path resolution

Purpose: The install.js script needs platform-aware path resolution to install GSD to both Claude Code and OpenCode directories. This plan extends getInstallPaths() to accept a platform parameter.

Output: Updated install-adapter.ts with multi-platform support
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-opencode-adapter-multi-platform-installation/03-RESEARCH.md
@src/platform/install-adapter.ts (current implementation)
@src/platform/paths.ts (ClaudeCodePaths, OpenCodePaths)

Key requirement: getInstallPaths() must return correct paths for both platforms so install.js can install to Claude Code, OpenCode, or both.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add platform parameter to getInstallPaths</name>
  <files>src/platform/install-adapter.ts</files>
  <action>
Read current install-adapter.ts first, then update getInstallPaths() to accept optional platform parameter:

Current signature (approximate):
```typescript
export function getInstallPaths(isGlobal: boolean, explicitConfigDir?: string): InstallPaths
```

New signature:
```typescript
export function getInstallPaths(
  isGlobal: boolean,
  explicitConfigDir?: string,
  platform: 'claude-code' | 'opencode' = 'claude-code'
): InstallPaths
```

Implementation changes:

1. Import OpenCodePaths from './paths'
2. Add platform parameter with default 'claude-code' (backward compatible)
3. Select path resolver based on platform:
   ```typescript
   const paths = platform === 'opencode'
     ? new OpenCodePaths()
     : new ClaudeCodePaths();
   ```
4. For local installs (`isGlobal === false`), use platform-specific local directory:
   - Claude Code: `.claude/` (existing)
   - OpenCode: `.opencode/`
5. Path prefix for markdown replacements should be platform-aware:
   - Claude Code: `~/.claude/` or `./.claude/`
   - OpenCode: `~/.config/opencode/` or `./.opencode/`

Note: explicitConfigDir only applies to Claude Code (CLAUDE_CONFIG_DIR). OpenCode uses OPENCODE_CONFIG env var which is already handled by OpenCodePaths.
  </action>
  <verify>
Run: `npm run build`
Expect: TypeScript compiles without errors
  </verify>
  <done>getInstallPaths() accepts platform parameter, defaults to claude-code for backward compatibility</done>
</task>

<task type="auto">
  <name>Task 2: Test multi-platform path resolution</name>
  <files>(test only - no files modified)</files>
  <action>
Run verification test to ensure both platforms return correct paths:

```bash
node -e "
const { getInstallPaths } = require('./dist/platform/install-adapter');

// Test 1: Claude Code global (default)
const cc = getInstallPaths(true, null, 'claude-code');
console.log('Claude Code global:');
console.log('  configDir:', cc.configDir);
console.log('  commandsDir:', cc.commandsDir);
console.log('  pathPrefix:', cc.pathPrefix);

// Test 2: OpenCode global
const oc = getInstallPaths(true, null, 'opencode');
console.log('OpenCode global:');
console.log('  configDir:', oc.configDir);
console.log('  commandsDir:', oc.commandsDir);
console.log('  pathPrefix:', oc.pathPrefix);

// Test 3: Backward compatibility (no platform arg)
const bc = getInstallPaths(true);
console.log('Backward compat (no platform):');
console.log('  configDir:', bc.configDir);

// Verify paths
const homeDir = require('os').homedir();
console.log('\\nVerification:');
console.log('  CC commands ends with /commands/gsd:', cc.commandsDir.endsWith('/commands/gsd'));
console.log('  OC commands ends with /command/gsd:', oc.commandsDir.endsWith('/command/gsd'));
console.log('  BC defaults to Claude Code:', bc.configDir.includes('.claude'));
"
```
  </action>
  <verify>
Test output shows:
- Claude Code commandsDir ends with /commands/gsd
- OpenCode commandsDir ends with /command/gsd (singular!)
- Backward compatibility defaults to Claude Code
  </verify>
  <done>Multi-platform path resolution verified for both platforms</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` - compiles without errors
2. getInstallPaths(true, null, 'claude-code') returns Claude Code paths
3. getInstallPaths(true, null, 'opencode') returns OpenCode paths
4. getInstallPaths(true) still works (backward compatible, defaults to claude-code)
5. OpenCode paths use `command/gsd` (singular) structure
</verification>

<success_criteria>
- getInstallPaths() accepts platform parameter
- Default platform is claude-code (backward compatible)
- OpenCode paths use correct directory structure
- TypeScript build succeeds
- Existing install.js still works without changes (yet)
</success_criteria>

<output>
After completion, create `.planning/phases/03-opencode-adapter-multi-platform-installation/03-03-SUMMARY.md`
</output>
