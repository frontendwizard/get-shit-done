---
phase: 03-opencode-adapter-multi-platform-installation
plan: 05
type: execute
wave: 4
depends_on: ["03-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "OpenCode installation creates command files in correct directory"
    - "Commands are discoverable by OpenCode"
    - "Basic non-agent commands work on OpenCode"
    - "Claude Code installation still works correctly (no regression)"
    - "--platform=both installs to both directories"
    - "Commands are registered successfully on selected platforms"
  artifacts: []
  key_links: []
---

<objective>
Verify multi-platform installation and command execution

Purpose: Confirm Phase 3 success criteria are met - users can install GSD for OpenCode and execute basic workflows on both platforms.

Output: Verification report confirming all requirements satisfied
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-opencode-adapter-multi-platform-installation/03-CONTEXT.md

Phase 3 Success Criteria (from ROADMAP.md):
1. Installer presents checkbox selection for Claude Code, OpenCode, or both
2. OpenCode adapter implements platform interface contract
3. Basic slash commands execute on OpenCode (new-project, status, help)
4. OpenCode config file (opencode.json) is created and commands registered
5. Installation verifies commands registered successfully on selected platforms
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify installer TUI and --platform flag</name>
  <files>(verification only)</files>
  <action>
Run automated verification tests:

**Test 1: Help text includes --platform option**
```bash
node bin/install.js --help | grep -E "platform|Platform"
```
Expect: Shows --platform option with values

**Test 2: Non-interactive with each platform value**
```bash
# Claude Code only
echo "" | node bin/install.js --global --platform=claude-code 2>&1 | head -5

# OpenCode only
XDG_CONFIG_HOME=/tmp/oc-verify node bin/install.js --global --platform=opencode 2>&1 | head -5

# Both platforms
XDG_CONFIG_HOME=/tmp/oc-verify node bin/install.js --global --platform=both 2>&1 | head -5
```
Expect: Each shows correct platform being installed

**Test 3: Invalid platform value**
```bash
node bin/install.js --global --platform=invalid 2>&1 | head -5
```
Expect: Error message about invalid platform value
  </action>
  <verify>
All three test cases pass, --platform flag works correctly
  </verify>
  <done>Installer TUI and --platform flag verified working</done>
</task>

<task type="auto">
  <name>Task 2: Verify OpenCode file structure</name>
  <files>(verification only)</files>
  <action>
Install for OpenCode and verify correct file structure:

```bash
# Clean test directory
rm -rf /tmp/opencode-verify
mkdir -p /tmp/opencode-verify

# Install for OpenCode
XDG_CONFIG_HOME=/tmp/opencode-verify node bin/install.js --global --platform=opencode

# Verify structure
echo "=== Directory Structure ==="
find /tmp/opencode-verify/opencode -type f | head -20

echo "=== Commands Directory ==="
ls -la /tmp/opencode-verify/opencode/command/gsd/ 2>/dev/null || echo "ERROR: command/gsd not found"

echo "=== Config File ==="
cat /tmp/opencode-verify/opencode/opencode.json 2>/dev/null || echo "ERROR: opencode.json not found"

echo "=== Sample Command Content (path prefix check) ==="
head -10 /tmp/opencode-verify/opencode/command/gsd/help.md 2>/dev/null | grep -E "@|path"
```

Expected structure:
```
/tmp/opencode-verify/opencode/
├── command/
│   └── gsd/
│       ├── help.md
│       ├── new-project.md
│       └── ... (all commands)
├── get-shit-done/
│   └── ... (workflows, templates)
├── agents/
│   └── gsd-*.md
├── hooks/
│   └── ... (hook scripts)
└── opencode.json
```
  </action>
  <verify>
- command/gsd/ directory exists with all commands
- opencode.json config file exists
- Path references in markdown files use ~/.config/opencode/ (not ~/.claude/)
  </verify>
  <done>OpenCode file structure verified correct</done>
</task>

<task type="auto">
  <name>Task 3: Verify Claude Code installation (regression test)</name>
  <files>(verification only)</files>
  <action>
Ensure Claude Code installation still works correctly:

```bash
# Clean test directory
rm -rf /tmp/claude-verify
mkdir -p /tmp/claude-verify

# Install for Claude Code with custom config dir
CLAUDE_CONFIG_DIR=/tmp/claude-verify node bin/install.js --global --platform=claude-code

# Verify structure
echo "=== Directory Structure ==="
find /tmp/claude-verify -type f | head -20

echo "=== Commands Directory ==="
ls -la /tmp/claude-verify/commands/gsd/ 2>/dev/null || echo "ERROR: commands/gsd not found"

echo "=== Settings File ==="
cat /tmp/claude-verify/settings.json 2>/dev/null || echo "ERROR: settings.json not found"

echo "=== Sample Command Content (path prefix check) ==="
head -10 /tmp/claude-verify/commands/gsd/help.md 2>/dev/null | grep -E "@|path"
```

Expected:
- commands/gsd/ directory (plural, with gsd subdirectory)
- settings.json with hooks array
- Path references use ~/.claude/ (correct for Claude Code)
  </action>
  <verify>
- Claude Code structure unchanged from Phase 2
- settings.json contains hooks registration
- No regressions from multi-platform changes
  </verify>
  <done>Claude Code installation verified (no regression)</done>
</task>

<task type="auto">
  <name>Task 4: Verify --platform=both installs to both directories</name>
  <files>(verification only)</files>
  <action>
Verify that selecting 'both' actually installs to both directories:

```bash
# Clean test directories
rm -rf /tmp/both-verify-claude /tmp/both-verify-oc
mkdir -p /tmp/both-verify-claude /tmp/both-verify-oc

# Install for both platforms
CLAUDE_CONFIG_DIR=/tmp/both-verify-claude XDG_CONFIG_HOME=/tmp/both-verify-oc node bin/install.js --global --platform=both

# Verify Claude Code installation
echo "=== Claude Code Installation ==="
ls /tmp/both-verify-claude/commands/gsd/ 2>/dev/null | head -5 || echo "ERROR: Claude Code commands not found"
cat /tmp/both-verify-claude/settings.json 2>/dev/null | head -5 || echo "ERROR: settings.json not found"

# Verify OpenCode installation
echo "=== OpenCode Installation ==="
ls /tmp/both-verify-oc/opencode/command/gsd/ 2>/dev/null | head -5 || echo "ERROR: OpenCode commands not found"
cat /tmp/both-verify-oc/opencode/opencode.json 2>/dev/null | head -5 || echo "ERROR: opencode.json not found"

# Count files in each to verify they're populated
echo "=== File Counts ==="
echo "Claude Code commands: $(find /tmp/both-verify-claude/commands/gsd -name '*.md' 2>/dev/null | wc -l)"
echo "OpenCode commands: $(find /tmp/both-verify-oc/opencode/command/gsd -name '*.md' 2>/dev/null | wc -l)"
```
  </action>
  <verify>
- Both /tmp/both-verify-claude/commands/gsd/ AND /tmp/both-verify-oc/opencode/command/gsd/ exist
- Both directories have equal number of command files
- Both config files (settings.json and opencode.json) exist
  </verify>
  <done>--platform=both verified to install to both directories</done>
</task>

<task type="auto">
  <name>Task 5: Verify commands are discoverable after installation</name>
  <files>(verification only)</files>
  <action>
Verify that installed commands are registered and discoverable:

```bash
# Clean test directories
rm -rf /tmp/cmd-verify-claude /tmp/cmd-verify-oc
mkdir -p /tmp/cmd-verify-claude /tmp/cmd-verify-oc

# Install for both platforms
CLAUDE_CONFIG_DIR=/tmp/cmd-verify-claude XDG_CONFIG_HOME=/tmp/cmd-verify-oc node bin/install.js --global --platform=both

echo "=== Claude Code Command Discovery ==="
# Verify expected command files exist
for cmd in help new-project status plan-phase execute-phase; do
  if [ -f "/tmp/cmd-verify-claude/commands/gsd/${cmd}.md" ]; then
    echo "✓ /gsd:${cmd} - found"
  else
    echo "✗ /gsd:${cmd} - MISSING"
  fi
done

echo ""
echo "=== OpenCode Command Discovery ==="
# Verify expected command files exist
for cmd in help new-project status plan-phase execute-phase; do
  if [ -f "/tmp/cmd-verify-oc/opencode/command/gsd/${cmd}.md" ]; then
    echo "✓ /gsd:${cmd} - found"
  else
    echo "✗ /gsd:${cmd} - MISSING"
  fi
done

echo ""
echo "=== Command Registration Validation ==="
# Verify commands are properly formatted (have required metadata)
if head -20 /tmp/cmd-verify-claude/commands/gsd/help.md 2>/dev/null | grep -q "^#"; then
  echo "✓ Claude Code help.md has valid markdown structure"
else
  echo "✗ Claude Code help.md missing expected structure"
fi

if head -20 /tmp/cmd-verify-oc/opencode/command/gsd/help.md 2>/dev/null | grep -q "^#"; then
  echo "✓ OpenCode help.md has valid markdown structure"
else
  echo "✗ OpenCode help.md missing expected structure"
fi

# Count total commands registered
CC_COUNT=$(find /tmp/cmd-verify-claude/commands/gsd -name '*.md' 2>/dev/null | wc -l | tr -d ' ')
OC_COUNT=$(find /tmp/cmd-verify-oc/opencode/command/gsd -name '*.md' 2>/dev/null | wc -l | tr -d ' ')
echo ""
echo "Total commands registered:"
echo "  Claude Code: ${CC_COUNT}"
echo "  OpenCode: ${OC_COUNT}"

if [ "$CC_COUNT" -gt 0 ] && [ "$OC_COUNT" -gt 0 ] && [ "$CC_COUNT" -eq "$OC_COUNT" ]; then
  echo "✓ Both platforms have equal command registration"
else
  echo "✗ Command count mismatch between platforms"
fi
```
  </action>
  <verify>
- All core commands (help, new-project, status, plan-phase, execute-phase) exist
- Command files have valid markdown structure
- Both platforms have the same number of commands registered
- Success criterion #5 satisfied: "Installation verifies commands registered successfully"
  </verify>
  <done>Commands verified as discoverable and registered on both platforms</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Multi-platform installer with OpenCode support</what-built>
  <how-to-verify>
**Interactive TUI Verification:**

1. Run installer without flags (if you have a TTY):
   ```bash
   node bin/install.js
   ```
   - Should show checkbox with "Claude Code" and "OpenCode" options
   - Neither should be pre-selected
   - Press space to select, enter to confirm
   - At least one must be selected (required: true)

2. If you have OpenCode installed, verify commands appear:
   - Install with `--platform=opencode`
   - Launch OpenCode
   - Type `/gsd:` and check autocomplete
   - Run `/gsd:help` command

3. Verify Claude Code still works:
   - Install with `--platform=claude-code`
   - Launch Claude Code
   - Run `/gsd:help` command

**Note:** If OpenCode is not installed on your system, verify:
- The file structure is created correctly (Task 2 output)
- Path prefixes are replaced correctly in markdown files
- Config file (opencode.json) is created
  </how-to-verify>
  <resume-signal>Type "approved" if verification passes, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 3 Success Criteria Checklist:

1. [ ] Installer presents checkbox selection for Claude Code, OpenCode, or both
   - Verified in Task 1 and checkpoint

2. [ ] OpenCode adapter implements platform interface contract
   - Verified in Plan 03-02

3. [ ] Basic slash commands execute on OpenCode
   - Verified in checkpoint (if OpenCode available)
   - Structure verification shows commands in correct location

4. [ ] OpenCode config file (opencode.json) is created
   - Verified in Task 2

5. [ ] Installation verifies commands registered successfully
   - Verified in Task 5 (command discovery check)

6. [ ] --platform=both installs to both directories
   - Verified in Task 4 (dual installation check)
</verification>

<success_criteria>
- All automated verification tests pass
- No regressions in Claude Code installation
- OpenCode file structure correct
- --platform=both creates files in both Claude Code and OpenCode directories
- Commands are discoverable and registered on both platforms
- Human verification of TUI and command execution (if platform available)
</success_criteria>

<output>
After completion, create `.planning/phases/03-opencode-adapter-multi-platform-installation/03-05-SUMMARY.md`
</output>
