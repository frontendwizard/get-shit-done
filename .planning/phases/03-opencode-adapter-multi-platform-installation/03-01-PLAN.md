---
phase: 03-opencode-adapter-multi-platform-installation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/platform/paths.ts
  - src/platform/index.ts
autonomous: true

must_haves:
  truths:
    - "npm install succeeds with new dependencies"
    - "OpenCodePaths.getCommandsDir() returns path ending in /command/gsd (singular, with gsd subdirectory)"
    - "TypeScript compiles without errors after path changes"
  artifacts:
    - path: "package.json"
      provides: "New dependencies for Phase 3"
      contains: "@inquirer/checkbox"
    - path: "src/platform/paths.ts"
      provides: "Corrected OpenCode command directory path"
      contains: "command"
  key_links:
    - from: "package.json"
      to: "node_modules"
      via: "npm install"
      pattern: "@inquirer/checkbox"
---

<objective>
Add Phase 3 dependencies and fix OpenCodePaths command directory path

Purpose: Research identified that OpenCode uses `command/` (singular) not `commands/` (plural). Also need @inquirer/checkbox for multi-platform TUI and jsonc-parser for JSONC config handling.

Output: Updated package.json with dependencies, corrected OpenCodePaths class
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-opencode-adapter-multi-platform-installation/03-RESEARCH.md

Key research findings:
- OpenCode commands directory: `.opencode/command/` (singular, not plural)
- For GSD namespacing: `.opencode/command/gsd/` (nested like Claude Code)
- Dependencies needed: @inquirer/checkbox (39M+ downloads), jsonc-parser (Microsoft's JSONC parser)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Phase 3 dependencies to package.json</name>
  <files>package.json</files>
  <action>
Add two new dependencies to package.json:

1. `@inquirer/checkbox` - version ^3.0.0 or latest major
   - Purpose: Multi-select TUI for platform choice in installer
   - Note: This is a runtime dependency (not devDependency) since install.js uses it

2. `jsonc-parser` - version ^3.0.0 or latest major
   - Purpose: Parse OpenCode's JSONC config files (JSON with comments)
   - Note: This is a runtime dependency since adapter uses it

Add these to a new "dependencies" section (package.json currently only has devDependencies).

Run `npm install` to verify dependencies resolve correctly.
  </action>
  <verify>
Run: `npm install && npm ls @inquirer/checkbox jsonc-parser`
Expect: Both packages listed with resolved versions, no npm errors
  </verify>
  <done>package.json has dependencies section with @inquirer/checkbox and jsonc-parser, npm install succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Fix OpenCodePaths command directory path</name>
  <files>src/platform/paths.ts</files>
  <action>
Update OpenCodePaths.getCommandsDir() to return correct path:

Current (WRONG):
```typescript
getCommandsDir(): string {
  return path.join(this.getConfigDir(), 'commands');
}
```

Corrected:
```typescript
getCommandsDir(): string {
  return path.join(this.getConfigDir(), 'command', 'gsd');
}
```

Key changes:
1. Change 'commands' (plural) to 'command' (singular) - matches OpenCode's actual directory structure
2. Add 'gsd' subdirectory for namespacing - prevents collision with user's custom commands
3. Update the JSDoc comment to reflect the correct structure

This mirrors ClaudeCodePaths pattern: `{configDir}/command/gsd/` (OpenCode) vs `{configDir}/commands/gsd/` (Claude Code)
  </action>
  <verify>
Run: `npm run build`
Expect: TypeScript compiles without errors, dist/platform/paths.js updated
  </verify>
  <done>OpenCodePaths.getCommandsDir() returns path ending in /command/gsd/, TypeScript compiles</done>
</task>

<task type="auto">
  <name>Task 3: Export jsonc-parser types for OpenCode adapter</name>
  <files>src/platform/index.ts</files>
  <action>
Verify src/platform/index.ts exports are correct for Phase 3.

Current exports should include:
- PlatformType from './types'
- PathResolver, ClaudeCodePaths, OpenCodePaths from './paths'
- PlatformAdapter, AgentInstance, HookType from './adapter'
- PlatformRegistry from './registry'
- ClaudeCodeAdapter from './adapters/claude-code'

No changes needed if exports are complete. If OpenCodeAdapter export is missing, that's expected (created in Plan 03-02).

Run TypeScript build to verify export integrity.
  </action>
  <verify>
Run: `npm run build && node -e "const p = require('./dist/platform'); console.log(Object.keys(p))"`
Expect: Exports include at minimum: PlatformType, ClaudeCodePaths, OpenCodePaths, PlatformRegistry, ClaudeCodeAdapter
  </verify>
  <done>Platform module exports are valid, build succeeds</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm install` - succeeds without errors
2. `npm ls @inquirer/checkbox jsonc-parser` - shows both dependencies
3. `npm run build` - TypeScript compiles without errors
4. OpenCodePaths.getCommandsDir() returns correct path structure
</verification>

<success_criteria>
- package.json has new dependencies section with @inquirer/checkbox and jsonc-parser
- OpenCodePaths.getCommandsDir() returns path ending in `/command/gsd/`
- TypeScript build succeeds
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/03-opencode-adapter-multi-platform-installation/03-01-SUMMARY.md`
</output>
