---
phase: 01-platform-abstraction-foundation
plan: 05
type: execute
wave: 5
depends_on: [01-03, 01-04]
files_modified: []
autonomous: false

must_haves:
  truths:
    - Platform detection correctly identifies Claude Code in current environment
    - Installation completes successfully using path abstraction
    - All GSD commands are accessible after installation
    - No regressions compared to pre-abstraction installation
    - No platform-specific markers in .planning/ directories
    - Command definitions are platform-agnostic
    - All path references use runtime resolution
  artifacts: []
  key_links: []
---

<objective>
Verify platform abstraction foundation works correctly with existing Claude Code installation and satisfies portability requirements.

Purpose: Ensure path resolution abstraction integrates seamlessly with current codebase, maintains backward compatibility, validates portability requirements (PORT-01, PORT-02, PORT-04, CMD-03), and sets solid foundation for Phase 2.

Output: Verified working installation using platform abstraction layer with confirmed portability compliance.
</objective>

<execution_context>
@/Users/juliano.farias/code/github/get-shit-done/.claude/get-shit-done/workflows/execute-plan.md
@/Users/juliano.farias/code/github/get-shit-done/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/juliano.farias/code/github/get-shit-done/.planning/PROJECT.md
@/Users/juliano.farias/code/github/get-shit-done/.planning/ROADMAP.md
@/Users/juliano.farias/code/github/get-shit-done/.planning/STATE.md
@/Users/juliano.farias/code/github/get-shit-done/.planning/REQUIREMENTS.md

Dependencies:
- Platform detection and registry (Plan 01, 02)
- Updated install script (Plan 03)
- TypeScript build infrastructure (Plan 04)

Success Criteria from ROADMAP.md Phase 1:
1. Platform can be detected at runtime (Claude Code vs OpenCode vs unknown) - PLAT-01
2. Platform registry returns correct adapter for detected platform - PLAT-03
3. Path resolution works without hardcoded ~/.claude/ (runtime resolution) - PLAT-06
4. Command definitions are platform-agnostic (markdown + YAML with no platform coupling) - CMD-03
5. Platform interface contract is defined and documented - PLAT-02

Portability Requirements:
- PORT-01: .planning/ directories work across platforms without modification
- PORT-02: No platform-specific data in PROJECT.md, ROADMAP.md, or planning artifacts
- PORT-04: Projects switchable between platforms without migration tools
</context>

<tasks>

<task type="auto">
  <name>Verify portability requirements compliance</name>
  <files></files>
  <action>
Run automated checks to verify portability requirements (PORT-01, PORT-02, PORT-04) and platform-agnostic command definitions (CMD-03).

Verification checks:

1. **PORT-01 & PORT-02: Check .planning/ for platform markers**
```bash
# Search for platform-specific references in planning files
grep -r "claude-code\|opencode\|Claude Code\|OpenCode" .planning/ --include="*.md" | grep -v "REQUIREMENTS.md" | grep -v "ROADMAP.md" | grep -v "RESEARCH.md" | grep -v "PLAN.md" || echo "✓ No platform markers in .planning/ artifacts"
```
Expected: No matches (only requirements/research docs should mention platforms)

2. **PORT-04: Verify no platform detection code in .planning/**
```bash
# Check for platform detection logic in planning files
grep -r "detectPlatform\|GSD_PLATFORM" .planning/ --include="*.md" | grep -v "REQUIREMENTS.md" | grep -v "ROADMAP.md" | grep -v "RESEARCH.md" | grep -v "PLAN.md" || echo "✓ No platform detection in .planning/ artifacts"
```
Expected: No matches

3. **PORT-01 & PORT-03: Confirm all paths use runtime resolution**
```bash
# Search for hardcoded ~/.claude/ paths in planning files
grep -r "~/.claude" .planning/ --include="*.md" | grep -v "REQUIREMENTS.md" | grep -v "ROADMAP.md" | grep -v "RESEARCH.md" | grep -v "PLAN.md" | grep -v "SUMMARY.md" || echo "✓ No hardcoded paths in .planning/ artifacts"
```
Expected: No matches in project artifacts (only in meta-documentation)

4. **CMD-03: Audit command definitions for platform-specific coupling**
```bash
# Check command markdown files for platform-specific references
echo "Checking command definitions for platform coupling..."

# Check for Task tool references (Claude Code specific)
grep -r "Task tool\|task-tool\|Task Tool" commands/gsd/ hooks/ agents/ --include="*.md" && echo "⚠ WARNING: Found Task tool references" || echo "✓ No Task tool references"

# Check for Claude Code specific assumptions
grep -r "Claude Code\|claude-code\|claude_code" commands/gsd/ hooks/ agents/ --include="*.md" | grep -v "@~" | grep -v "execution_context" && echo "⚠ WARNING: Found Claude Code coupling" || echo "✓ No Claude Code coupling"

# Check for OpenCode specific assumptions
grep -r "OpenCode\|opencode\|open-code" commands/gsd/ hooks/ agents/ --include="*.md" && echo "⚠ WARNING: Found OpenCode coupling" || echo "✓ No OpenCode coupling"

# Verify all agent spawns use platform-agnostic patterns
grep -r "<agent" commands/gsd/ agents/ --include="*.md" | head -5
echo "Review agent spawns above - should use generic patterns, not platform-specific syntax"
```
Expected: No platform-specific tool references, no platform assumptions

5. **Summary of portability status**
```bash
echo ""
echo "=== PORTABILITY VERIFICATION SUMMARY ==="
echo ""
echo "PORT-01: .planning/ works across platforms"
echo "PORT-02: No platform-specific data in artifacts"
echo "PORT-04: Runtime resolution, no platform markers"
echo "CMD-03: Commands are platform-agnostic"
echo ""
echo "If all checks passed, portability requirements satisfied ✓"
```

Create PORTABILITY-AUDIT.txt with findings:
```bash
cat > /tmp/portability-audit.txt << 'EOF'
# Portability Audit - Phase 1

Date: $(date +%Y-%m-%d)

## PORT-01: .planning/ Cross-Platform Compatibility
[Results of grep for platform markers]

## PORT-02: No Platform-Specific Data in Artifacts
[Results of grep for platform detection code]

## PORT-04: Runtime Path Resolution
[Results of grep for hardcoded ~/.claude/ paths]

## CMD-03: Platform-Agnostic Command Definitions
[Results of command definition audit]

## Verdict
[PASS/FAIL with specific issues if any]
EOF
```

If any issues found, document them clearly for fixing before proceeding.
  </action>
  <verify>
```bash
# Run all verification checks
bash -c "
  echo '=== Running Portability Checks ==='
  # Check executed via action above
  cat /tmp/portability-audit.txt
"
```
Expected: All checks pass, PASS verdict in audit file
  </verify>
  <done>Portability requirements verified: .planning/ has no platform markers, commands are platform-agnostic, paths use runtime resolution</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Platform abstraction foundation:
- Platform detection (src/platform/detection.ts) - detects Claude Code vs OpenCode
- Platform adapter interface contract (src/platform/adapter.ts) - defines PlatformAdapter contract (PLAT-02)
- Path resolution (src/platform/paths.ts) - abstracts ~/.claude/ and platform directories
- Registry factory (src/platform/registry.ts) - provides PathResolver for detected platform
- Install integration (bin/install.js + src/platform/install-adapter.ts) - uses abstraction
- TypeScript build (tsconfig.json, package.json) - compiles TypeScript to JavaScript
- Portability audit (automated verification of PORT-01, PORT-02, PORT-04, CMD-03)
  </what-built>

  <how-to-verify>
1. **Compile TypeScript source:**
```bash
cd /Users/juliano.farias/code/github/get-shit-done
npm install
npm run build
```
Expected: TypeScript compiles successfully, dist/ directory created with JS files

2. **Test platform detection:**
```bash
node -e "const { detectPlatform } = require('./dist/platform/detection'); console.log('Detected platform:', detectPlatform())"
```
Expected output: `Detected platform: claude-code`

3. **Test path resolution:**
```bash
node -e "const { PlatformRegistry } = require('./dist/platform/registry'); const r = PlatformRegistry.getPathResolver(); console.log('Config dir:', r.getConfigDir()); console.log('Commands dir:', r.getCommandsDir());"
```
Expected: Prints ~/.claude paths

4. **Verify PlatformAdapter interface contract exists:**
```bash
grep -A 5 "export interface PlatformAdapter" src/platform/adapter.ts
grep "Behavioral contract specification" src/platform/adapter.ts
```
Expected: Interface definition exists with behavioral contracts documented

5. **Test installation to temp directory:**
```bash
# Create temp test directory
mkdir -p /tmp/gsd-test-install
cd /tmp/gsd-test-install

# Run installation with explicit config dir
CLAUDE_CONFIG_DIR=/tmp/gsd-test-install/.claude node /Users/juliano.farias/code/github/get-shit-done/bin/install.js --global --force-statusline

# Verify structure
ls -la /tmp/gsd-test-install/.claude/commands/gsd/
ls -la /tmp/gsd-test-install/.claude/get-shit-done/
ls -la /tmp/gsd-test-install/.claude/agents/
cat /tmp/gsd-test-install/.claude/settings.json
```

Expected:
- Installation completes without errors
- commands/gsd/ directory contains *.md files
- get-shit-done/ directory contains workflow files
- agents/ directory contains gsd-*.md files
- settings.json exists with statusLine and hooks configured

6. **Verify path replacement in markdown files:**
```bash
# Check that @~/.claude/ references were replaced correctly
grep -r "@.*\.claude" /tmp/gsd-test-install/.claude/commands/gsd/ || echo "No hardcoded paths found (GOOD)"

# Should find references but they should match the install location
grep -r "@/tmp/gsd-test-install/\.claude" /tmp/gsd-test-install/.claude/commands/gsd/ | head -5
```

Expected: Markdown files use the correct absolute path (/tmp/gsd-test-install/.claude/), not hardcoded ~/.claude/

7. **Review portability audit results:**
```bash
cat /tmp/portability-audit.txt
```

Expected:
- PORT-01: PASS - No platform markers in .planning/ artifacts
- PORT-02: PASS - No platform-specific data in planning files
- PORT-04: PASS - All paths use runtime resolution
- CMD-03: PASS - Commands are platform-agnostic

8. **Cleanup test installation:**
```bash
rm -rf /tmp/gsd-test-install
```

9. **Check backward compatibility (optional - only if you want to test in real Claude Code):**
If you want to verify in your actual Claude Code instance:
```bash
cd /Users/juliano.farias/code/github/get-shit-done
node bin/install.js --global --force-statusline
```
Then launch Claude Code and run `/gsd:help` to verify commands work.

**Critical checks:**
- [ ] TypeScript compiles without errors
- [ ] Platform detection returns 'claude-code'
- [ ] Path resolution returns correct directories
- [ ] PlatformAdapter interface contract exists and is documented
- [ ] Installation completes successfully
- [ ] Markdown files have correct path references
- [ ] No hardcoded ~/.claude/ in installed files
- [ ] settings.json has statusLine and hooks configured
- [ ] Portability audit passes all checks (PORT-01, PORT-02, PORT-04, CMD-03)
  </how-to-verify>

  <resume-signal>
Type "verified" if all checks pass, or describe any issues found.

If issues found, I will fix them before proceeding to Phase 2.
  </resume-signal>
</task>

</tasks>

<verification>
Human has verified:
- Platform detection works correctly
- Path resolution returns correct directories
- PlatformAdapter interface contract is defined and documented (PLAT-02)
- Installation completes without errors
- Markdown file path replacement works correctly
- No regressions compared to previous installation behavior
- Portability requirements satisfied (PORT-01, PORT-02, PORT-04, CMD-03)
</verification>

<success_criteria>
Platform abstraction foundation verified working:
- TypeScript compiles successfully to JavaScript
- Platform detection identifies Claude Code in current environment (PLAT-01)
- Platform adapter interface contract defined and documented (PLAT-02)
- Platform registry returns correct PathResolver (PLAT-03)
- Path resolution abstracts away hardcoded ~/.claude/ references (PLAT-06)
- Installation uses platform abstraction without regressions
- Command definitions remain platform-agnostic (CMD-03)
- No platform-specific markers in .planning/ directories (PORT-01, PORT-02)
- All paths use runtime resolution (PORT-04)
- Ready for Phase 2 (Claude Code adapter extraction)
</success_criteria>

<output>
After completion, create `.planning/phases/01-platform-abstraction-foundation/01-05-SUMMARY.md`
</output>
