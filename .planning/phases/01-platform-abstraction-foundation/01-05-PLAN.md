---
phase: 01-platform-abstraction-foundation
plan: 05
type: execute
wave: 5
depends_on: [01-03, 01-04]
files_modified: []
autonomous: false

must_haves:
  truths:
    - Platform detection correctly identifies Claude Code in current environment
    - Installation completes successfully using path abstraction
    - All GSD commands are accessible after installation
    - No regressions compared to pre-abstraction installation
  artifacts: []
  key_links: []
---

<objective>
Verify platform abstraction foundation works correctly with existing Claude Code installation.

Purpose: Ensure path resolution abstraction integrates seamlessly with current codebase, maintains backward compatibility, and sets solid foundation for Phase 2.

Output: Verified working installation using platform abstraction layer.
</objective>

<execution_context>
@/Users/juliano.farias/code/github/get-shit-done/.claude/get-shit-done/workflows/execute-plan.md
@/Users/juliano.farias/code/github/get-shit-done/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/juliano.farias/code/github/get-shit-done/.planning/PROJECT.md
@/Users/juliano.farias/code/github/get-shit-done/.planning/ROADMAP.md
@/Users/juliano.farias/code/github/get-shit-done/.planning/STATE.md
@/Users/juliano.farias/code/github/get-shit-done/.planning/REQUIREMENTS.md

Dependencies:
- Platform detection and registry (Plan 01, 02)
- Updated install script (Plan 03)
- TypeScript build infrastructure (Plan 04)

Success Criteria from ROADMAP.md Phase 1:
1. Platform can be detected at runtime (Claude Code vs OpenCode vs unknown)
2. Platform registry returns correct adapter for detected platform
3. Path resolution works without hardcoded ~/.claude/ (runtime resolution)
4. Command definitions are platform-agnostic (markdown + YAML with no platform coupling)
5. Platform interface contract is defined and documented
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Platform abstraction foundation:
- Platform detection (src/platform/detection.ts) - detects Claude Code vs OpenCode
- Path resolution (src/platform/paths.ts) - abstracts ~/.claude/ and platform directories
- Registry factory (src/platform/registry.ts) - provides PathResolver for detected platform
- Install integration (bin/install.js + src/platform/install-adapter.ts) - uses abstraction
- TypeScript build (tsconfig.json, package.json) - compiles TypeScript to JavaScript
  </what-built>

  <how-to-verify>
1. **Compile TypeScript source:**
```bash
cd /Users/juliano.farias/code/github/get-shit-done
npm install
npm run build
```
Expected: TypeScript compiles successfully, dist/ directory created with JS files

2. **Test platform detection:**
```bash
node -e "const { detectPlatform } = require('./dist/platform/detection'); console.log('Detected platform:', detectPlatform())"
```
Expected output: `Detected platform: claude-code`

3. **Test path resolution:**
```bash
node -e "const { PlatformRegistry } = require('./dist/platform/registry'); const r = PlatformRegistry.getPathResolver(); console.log('Config dir:', r.getConfigDir()); console.log('Commands dir:', r.getCommandsDir());"
```
Expected: Prints ~/.claude paths

4. **Test installation to temp directory:**
```bash
# Create temp test directory
mkdir -p /tmp/gsd-test-install
cd /tmp/gsd-test-install

# Run installation with explicit config dir
CLAUDE_CONFIG_DIR=/tmp/gsd-test-install/.claude node /Users/juliano.farias/code/github/get-shit-done/bin/install.js --global --force-statusline

# Verify structure
ls -la /tmp/gsd-test-install/.claude/commands/gsd/
ls -la /tmp/gsd-test-install/.claude/get-shit-done/
ls -la /tmp/gsd-test-install/.claude/agents/
cat /tmp/gsd-test-install/.claude/settings.json
```

Expected:
- Installation completes without errors
- commands/gsd/ directory contains *.md files
- get-shit-done/ directory contains workflow files
- agents/ directory contains gsd-*.md files
- settings.json exists with statusLine and hooks configured

5. **Verify path replacement in markdown files:**
```bash
# Check that @~/.claude/ references were replaced correctly
grep -r "@.*\.claude" /tmp/gsd-test-install/.claude/commands/gsd/ || echo "No hardcoded paths found (GOOD)"

# Should find references but they should match the install location
grep -r "@/tmp/gsd-test-install/\.claude" /tmp/gsd-test-install/.claude/commands/gsd/ | head -5
```

Expected: Markdown files use the correct absolute path (/tmp/gsd-test-install/.claude/), not hardcoded ~/.claude/

6. **Cleanup test installation:**
```bash
rm -rf /tmp/gsd-test-install
```

7. **Check backward compatibility (optional - only if you want to test in real Claude Code):**
If you want to verify in your actual Claude Code instance:
```bash
cd /Users/juliano.farias/code/github/get-shit-done
node bin/install.js --global --force-statusline
```
Then launch Claude Code and run `/gsd:help` to verify commands work.

**Critical checks:**
- [ ] TypeScript compiles without errors
- [ ] Platform detection returns 'claude-code'
- [ ] Path resolution returns correct directories
- [ ] Installation completes successfully
- [ ] Markdown files have correct path references
- [ ] No hardcoded ~/.claude/ in installed files
- [ ] settings.json has statusLine and hooks configured
  </how-to-verify>

  <resume-signal>
Type "verified" if all checks pass, or describe any issues found.

If issues found, I will fix them before proceeding to Phase 2.
  </resume-signal>
</task>

</tasks>

<verification>
Human has verified:
- Platform detection works correctly
- Path resolution returns correct directories
- Installation completes without errors
- Markdown file path replacement works correctly
- No regressions compared to previous installation behavior
</verification>

<success_criteria>
Platform abstraction foundation verified working:
- TypeScript compiles successfully to JavaScript
- Platform detection identifies Claude Code in current environment
- Path resolution abstracts away hardcoded ~/.claude/ references
- Installation uses platform abstraction without regressions
- Command definitions remain platform-agnostic
- Ready for Phase 2 (Claude Code adapter extraction)
</success_criteria>

<output>
After completion, create `.planning/phases/01-platform-abstraction-foundation/01-05-SUMMARY.md`
</output>
