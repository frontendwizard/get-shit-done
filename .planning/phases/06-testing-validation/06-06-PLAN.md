---
phase: 06-testing-validation
plan: 06
type: execute
wave: 4
depends_on: ["06-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All TEST-01 through TEST-05 requirements verified"
    - "Test coverage meets acceptance threshold"
    - "No regressions in existing functionality"
  artifacts: []
  key_links: []
---

<objective>
Final verification checkpoint - run full test suite and verify TEST requirements are satisfied.

Purpose: Human verification that all Phase 6 tests pass and requirements are complete.
Output: Verified test suite with coverage report.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/phases/06-testing-validation/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full test suite with coverage</name>
  <files></files>
  <action>
Run the complete test suite with coverage reporting:

```bash
npm run test:coverage
```

This will:
1. Run all test files in tests/**/*.test.ts
2. Generate coverage report (text, JSON, HTML)
3. Show which source files have coverage

Expected output:
- All tests pass (no failures)
- Coverage report shows src/platform/* files covered
- HTML report generated in coverage/ directory
  </action>
  <verify>
`npm run test:coverage` completes without failures.
Coverage report shows coverage for:
- src/platform/detection.ts
- src/platform/paths.ts
- src/platform/registry.ts
- src/platform/adapters/claude-code.ts
- src/platform/adapters/opencode.ts
- src/platform/agent-runner.ts
- src/platform/install-adapter.ts
  </verify>
  <done>Full test suite passes with coverage report generated</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete test infrastructure for Phase 6:
- Vitest testing framework configured
- Unit tests for platform detection, paths, registry
- Contract tests for both adapters
- Agent runner and install adapter tests
- Regression tests for Claude Code 1.x compatibility
- Cross-platform .planning/ portability tests
  </what-built>
  <how-to-verify>
1. Run `npm run test:coverage` and verify all tests pass
2. Check coverage report in terminal output
3. Verify TEST requirements coverage:

**TEST-01: Shared test suite on both platforms**
- Contract tests in tests/contract/ run against both adapters
- Same assertions verify both ClaudeCodeAdapter and OpenCodeAdapter

**TEST-02: Platform adapter contract tests**
- tests/contract/adapter.contract.ts defines shared contract
- tests/contract/claude-code.contract.test.ts runs contract for Claude Code
- tests/contract/opencode.contract.test.ts runs contract for OpenCode

**TEST-03: Integration tests for installations**
- tests/unit/platform/install-adapter.test.ts covers path generation
- (Note: Full installer integration deferred - install.js is JavaScript not TypeScript)

**TEST-04: Regression tests for Claude Code**
- tests/regression/claude-code-1x.test.ts verifies:
  - Settings preservation
  - Hook idempotency
  - Command path structure

**TEST-05: Cross-platform workflow validation**
- tests/integration/cross-platform.test.ts verifies:
  - .planning/ files have no platform-specific paths
  - Both adapters can access same content
  - Adapters don't modify .planning/

4. Optionally open coverage/index.html to see detailed report
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass and requirements are met, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `npm run test:coverage` shows all tests passing
2. Coverage report generated
3. TEST-01 through TEST-05 requirements verified
4. No regressions identified
</verification>

<success_criteria>
- All tests pass (0 failures)
- Coverage report shows platform modules tested
- Human verification confirms requirements met
- Phase 6 ready for completion
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-validation/06-06-SUMMARY.md`
</output>
