---
phase: 05-lifecycle-hooks
plan: 04
type: execute
wave: 4
depends_on: ["05-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Claude Code installation registers SessionStart hook"
    - "Claude Code statusline displays correctly"
    - "OpenCode installation completes without hook errors"
    - "Hook scripts execute without errors"
  artifacts:
    - path: "~/.claude/settings.json"
      provides: "Hook configuration"
      contains: "hooks.SessionStart"
  key_links:
    - from: "hooks/gsd-check-update.js"
      to: "~/.claude/cache/gsd-update-check.json"
      via: "background process writes cache"
      pattern: "gsd-update-check.json"
    - from: "hooks/statusline.js"
      to: "~/.claude/cache/gsd-update-check.json"
      via: "reads cache to show update notification"
      pattern: "gsd-update-check.json"
---

<objective>
Verify lifecycle hooks work end-to-end on both platforms.

Purpose: Confirm all HOOK requirements are satisfied - hooks register, execute, and gracefully degrade where appropriate.

Output: Human-verified confirmation that hooks work on Claude Code and degrade silently on OpenCode.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-lifecycle-hooks/05-CONTEXT.md
@.planning/phases/05-lifecycle-hooks/05-RESEARCH.md
@.planning/phases/05-lifecycle-hooks/05-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and prepare for testing</name>
  <files>dist/</files>
  <action>
Build the project to ensure all changes are compiled:

1. Run `npm run build`
2. Verify build completes without errors
3. Verify dist/ contains updated adapter files:
   - dist/platform/adapters/claude-code.js
   - dist/platform/adapters/opencode.js

This prepares the codebase for human verification testing.
  </action>
  <verify>Run `npm run build && ls -la dist/platform/adapters/`</verify>
  <done>Build completes successfully, dist/ contains updated adapter files</done>
</task>

<task type="auto">
  <name>Task 2: Prepare verification checklist</name>
  <files>N/A (output preparation)</files>
  <action>
Prepare detailed verification steps for human checkpoint:

**Claude Code Verification:**
1. Run global install: `node bin/install.js`
2. Select Claude Code when prompted
3. Check ~/.claude/settings.json contains:
   - `hooks.SessionStart` array with gsd-check-update entry
   - `statusLine` object with statusline.js command
4. Start new Claude Code session
5. Wait ~5 seconds for background update check
6. Verify ~/.claude/cache/gsd-update-check.json exists with recent timestamp
7. Verify statusline shows model and context info

**OpenCode Verification:**
1. Run global install: `node bin/install.js`
2. Select OpenCode when prompted
3. Verify installation completes without hook-related errors
4. Check ~/.opencode/opencode.json does NOT contain hooks section
5. Verify OpenCode launches normally

Output these steps for the human checkpoint.
  </action>
  <verify>Verification steps documented and ready for human review</verify>
  <done>Verification checklist prepared for human checkpoint</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Lifecycle hooks implementation with cross-platform support</what-built>
  <how-to-verify>
**Claude Code Verification (REQUIRED):**
1. Run `node bin/install.js` and select Claude Code
2. Check settings.json has hooks configured:
   `cat ~/.claude/settings.json | grep -A5 SessionStart`
3. Check statusline is configured:
   `cat ~/.claude/settings.json | grep -A2 statusLine`
4. Start a NEW Claude Code session
5. Verify statusline displays (model | directory | context bar)
6. Check update cache was created:
   `cat ~/.claude/cache/gsd-update-check.json`

**OpenCode Verification (if available):**
1. Run `node bin/install.js` and select OpenCode
2. Confirm installation completes without errors
3. Verify opencode.json has NO hooks section:
   `cat ~/.opencode/opencode.json | grep hooks` (should be empty)

**Config Disable Test (optional):**
1. Add to settings.json: `"gsd": { "hooks": { "enabled": false } }`
2. Re-run install
3. Verify message: "Hooks disabled via config"
  </how-to-verify>
  <resume-signal>Type "approved" if hooks work on Claude Code and degrade silently on OpenCode, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] HOOK-01: SessionStart hook registered on Claude Code, skipped on OpenCode
- [ ] HOOK-02: StatusLine displays model/context on Claude Code
- [ ] HOOK-03: Hook registration succeeds on Claude Code, silent skip on OpenCode
- [ ] HOOK-04: Update check cache file created (hook executed)
</verification>

<success_criteria>
All HOOK requirements verified:
- SessionStart executes on Claude Code (update check runs)
- StatusLine shows context on Claude Code
- OpenCode gracefully degrades (no errors, no hooks)
- Optional disable config works
Phase 5 complete.
</success_criteria>

<output>
After completion, create `.planning/phases/05-lifecycle-hooks/05-04-SUMMARY.md`
</output>
