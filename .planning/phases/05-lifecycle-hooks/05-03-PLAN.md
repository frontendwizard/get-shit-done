---
phase: 05-lifecycle-hooks
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - bin/install.js
autonomous: true

must_haves:
  truths:
    - "Users can disable hooks via config setting"
    - "Config check happens before any hook registration"
    - "Existing installations without config continue to work (backward compatible)"
  artifacts:
    - path: "bin/install.js"
      provides: "Optional hook disable config support"
      contains: "gsd.*hooks.*enabled"
  key_links:
    - from: "bin/install.js"
      to: "settings.json gsd.hooks.enabled"
      via: "config check before registration"
      pattern: "gsd\\.hooks"
---

<objective>
Add optional hook disabling via config file.

Purpose: Allow users to troubleshoot by disabling hooks if they cause issues, per user decision in CONTEXT.md ("Allow users to disable hooks via config file for troubleshooting").

Output: install.js checks for gsd.hooks.enabled config before registering hooks.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-lifecycle-hooks/05-CONTEXT.md
@.planning/phases/05-lifecycle-hooks/05-RESEARCH.md
@.planning/phases/05-lifecycle-hooks/05-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add config check for hook enable/disable</name>
  <files>bin/install.js</files>
  <action>
Add a function to check if hooks are enabled via config:

```javascript
/**
 * Check if hooks are enabled in config
 *
 * Users can disable hooks by setting:
 *   { "gsd": { "hooks": { "enabled": false } } }
 *
 * Default: true (hooks enabled if not specified)
 */
function areHooksEnabled(settings) {
  // Default to enabled if not specified
  if (!settings.gsd || !settings.gsd.hooks) {
    return true;
  }
  // Explicitly false disables hooks
  return settings.gsd.hooks.enabled !== false;
}
```

Then update the hook registration block:
```javascript
if (adapter.supportsHooks() && areHooksEnabled(settings)) {
  // ... existing hook registration logic
}
```

And update statusline handling similarly:
```javascript
if (adapter.supportsStatusLine() && areHooksEnabled(settings)) {
  // ... existing statusline logic
}
```

Add a log message when hooks are disabled:
```javascript
if (!areHooksEnabled(settings)) {
  console.log(`  ${dim}Hooks disabled via config (gsd.hooks.enabled: false)${reset}`);
}
```
  </action>
  <verify>Run `node bin/install.js --help` to verify no syntax errors</verify>
  <done>areHooksEnabled() function added and used for hook/statusline decisions</done>
</task>

<task type="auto">
  <name>Task 2: Test backward compatibility with default behavior</name>
  <files>bin/install.js</files>
  <action>
Verify the config check is backward compatible:

1. When no gsd config exists: hooks should be enabled (default true)
2. When gsd.hooks exists but enabled not specified: hooks should be enabled
3. When gsd.hooks.enabled = true: hooks should be enabled
4. When gsd.hooks.enabled = false: hooks should be disabled

Test with a simple Node REPL check:
```javascript
// Copy areHooksEnabled function, then test:
areHooksEnabled({}) // should return true
areHooksEnabled({ gsd: {} }) // should return true
areHooksEnabled({ gsd: { hooks: {} } }) // should return true
areHooksEnabled({ gsd: { hooks: { enabled: true } } }) // should return true
areHooksEnabled({ gsd: { hooks: { enabled: false } } }) // should return false
```

This confirms default behavior is preserved for existing installations.
  </action>
  <verify>Run the test scenarios in Node REPL to verify all return expected values</verify>
  <done>Config check is backward compatible - hooks enabled by default when no config</done>
</task>

</tasks>

<verification>
- [ ] areHooksEnabled() function exists in install.js
- [ ] Hook registration checks areHooksEnabled(settings)
- [ ] StatusLine registration checks areHooksEnabled(settings)
- [ ] Default is true when no gsd.hooks config exists
- [ ] Explicit false disables hooks
- [ ] Log message shown when hooks disabled
</verification>

<success_criteria>
Hook disabling config option complete:
- Users can set gsd.hooks.enabled: false to disable hooks
- Default behavior unchanged (hooks enabled)
- Backward compatible with existing installations
Ready for final verification in Plan 04.
</success_criteria>

<output>
After completion, create `.planning/phases/05-lifecycle-hooks/05-03-SUMMARY.md`
</output>
