---
phase: 05-lifecycle-hooks
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - bin/install.js
autonomous: true

must_haves:
  truths:
    - "Hook registration uses adapter.supportsHooks() check before attempting"
    - "StatusLine registration uses adapter.supportsStatusLine() check before attempting"
    - "OpenCode installation completes without hook-related errors"
    - "Claude Code installation registers hooks as before"
  artifacts:
    - path: "bin/install.js"
      provides: "Cross-platform hook registration with capability checks"
      contains: "supportsHooks"
  key_links:
    - from: "bin/install.js"
      to: "adapter.supportsHooks()"
      via: "capability check before registerHook()"
      pattern: "supportsHooks.*registerHook"
    - from: "bin/install.js"
      to: "adapter.supportsStatusLine()"
      via: "capability check before statusLine config"
      pattern: "supportsStatusLine"
---

<objective>
Update install.js to use capability-based hook registration.

Purpose: Make installation work on both platforms - Claude Code gets hooks registered, OpenCode skips silently per graceful degradation strategy.

Output: install.js checks adapter capabilities before hook/statusline registration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-lifecycle-hooks/05-CONTEXT.md
@.planning/phases/05-lifecycle-hooks/05-RESEARCH.md
@.planning/phases/05-lifecycle-hooks/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add capability checks for hook registration</name>
  <files>bin/install.js</files>
  <action>
Update the hook registration section in install() function (around line 505-515):

Current code:
```javascript
if (platform === 'claude-code') {
  const hasGsdUpdateHook = settings.hooks?.SessionStart?.some(...);
  if (!hasGsdUpdateHook) {
    await adapter.registerHook('SessionStart', updateCheckCommand);
  }
}
```

Change to use adapter capability check:
```javascript
if (adapter.supportsHooks()) {
  const hasGsdUpdateHook = settings.hooks?.SessionStart?.some(...);
  if (!hasGsdUpdateHook) {
    await adapter.registerHook('SessionStart', updateCheckCommand);
    console.log(`  ${green}ok${reset} Configured update check hook`);
  }
}
// No else clause - silent skip per graceful degradation
```

This makes the code platform-agnostic by using the adapter's capability method instead of hardcoded platform check.
  </action>
  <verify>Run `node bin/install.js --help` to verify script loads without syntax errors</verify>
  <done>Hook registration uses adapter.supportsHooks() instead of platform === 'claude-code'</done>
</task>

<task type="auto">
  <name>Task 2: Add capability check for statusline configuration</name>
  <files>bin/install.js</files>
  <action>
Update finishInstall() function (around line 527-534) to check statusline capability:

Current code in finishInstall():
```javascript
if (shouldInstallStatusline) {
  settings.statusLine = { type: 'command', command: statuslineCommand };
  console.log(`  ${green}ok${reset} Configured statusline`);
}
```

Update to also check adapter capability:
```javascript
if (shouldInstallStatusline && adapter.supportsStatusLine()) {
  settings.statusLine = { type: 'command', command: statuslineCommand };
  console.log(`  ${green}ok${reset} Configured statusline`);
}
```

Also update the handleStatusline() function (around line 549) to skip the prompt entirely if platform doesn't support statusline:
```javascript
function handleStatusline(settings, isInteractive, adapter, callback) {
  // Skip statusline entirely if platform doesn't support it
  if (!adapter.supportsStatusLine()) {
    callback(false);
    return;
  }
  // ... rest of existing logic
}
```

This requires adding adapter parameter to handleStatusline() and updating its call sites.
  </action>
  <verify>Run `node bin/install.js --help` to verify script loads without syntax errors</verify>
  <done>StatusLine configuration uses adapter.supportsStatusLine() capability check</done>
</task>

<task type="auto">
  <name>Task 3: Verify cross-platform installation simulation</name>
  <files>bin/install.js</files>
  <action>
Manually verify the install script works for both platforms:

1. Run `node bin/install.js --help` - should show help without errors
2. Verify adapter capability methods are called correctly in the code flow
3. Check that console messages are appropriate for each platform

Note: Full installation test requires human verification (Plan 03). This task confirms the code is syntactically correct and capability checks are in place.

Check these code patterns exist:
- `adapter.supportsHooks()` is called before registerHook()
- `adapter.supportsStatusLine()` is called before statusLine config
- No hardcoded `platform === 'claude-code'` for hook/statusline decisions
  </action>
  <verify>Run `grep -n 'supportsHooks\|supportsStatusLine' bin/install.js` to confirm capability checks exist</verify>
  <done>install.js uses capability-based checks for all hook/statusline operations</done>
</task>

</tasks>

<verification>
- [ ] `node bin/install.js --help` runs without errors
- [ ] Hook registration guarded by `adapter.supportsHooks()`
- [ ] StatusLine config guarded by `adapter.supportsStatusLine()`
- [ ] No hardcoded platform checks for hook decisions
- [ ] Console output appropriate for each platform path
</verification>

<success_criteria>
install.js is platform-agnostic for hook registration:
- Uses adapter capability methods
- Claude Code: Registers hooks and statusline
- OpenCode: Silently skips hooks and statusline
Ready for human verification in Plan 03.
</success_criteria>

<output>
After completion, create `.planning/phases/05-lifecycle-hooks/05-02-SUMMARY.md`
</output>
