---
phase: 02-claude-code-adapter-backward-compatibility
plan: 03
type: execute
wave: 3
depends_on: [02-02]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Fresh installation works identically to v1.x"
    - "Upgrade preserves existing user settings"
    - "Commands execute without errors"
    - "settings.json format is unchanged from v1.x"
    - "Hooks are registered correctly"
    - "Runtime verification passed during install"
  artifacts:
    - path: "~/.claude/settings.json"
      provides: "Properly formatted settings with GSD hooks (v1.x format)"
      contains: "gsd-check-update.js"
    - path: "~/.claude/commands/gsd/execute-phase.md"
      provides: "Installed command files with template rendering applied"
      contains: "@~/.claude/get-shit-done/"
  key_links:
    - from: "~/.claude/settings.json"
      to: "~/.claude/hooks/gsd-check-update.js"
      via: "SessionStart hook registration"
      pattern: "gsd-check-update"
---

<objective>
Verify that the adapter implementation works correctly by running install.js and testing that it behaves identically to v1.x. Confirms backward compatibility, settings.json format, command file rendering, and hook execution.

Purpose: Confirm zero regression from adapter refactoring and validate all installation requirements.
Output: Verified working installation with backward compatibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-CONTEXT.md

# Prior plans
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-01-SUMMARY.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-02-SUMMARY.md

# Implementation to test
@bin/install.js
@src/platform/adapters/claude-code.ts
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 2 adapter implementation:
- ClaudeCodeAdapter with minimal viable scope (implemented methods + Phase 4 stubs)
- install.js using adapter pattern
- All existing install.js logic preserved
- Runtime verification in install.js

This verification tests backward compatibility and validates installation requirements.
  </what-built>

  <how-to-verify>
**1. Build and run installation:**
```bash
npm run build
node bin/install.js --global
```

Should complete without errors and show "âœ“ Runtime verification: adapter methods executed correctly"

**2. Verify settings.json format (backward compatibility):**
```bash
cat ~/.claude/settings.json
```

Check:
- File exists and is valid JSON
- Has hooks.SessionStart array with gsd-check-update.js path
- Has hooks.StatusLine array with gsd-statusline.js path (if not skipped)
- Format matches v1.x (hooks array structure unchanged)
- Existing settings preserved if upgrading
- Backup file created (settings.json.backup)

**3. Verify command files (template rendering):**
```bash
ls ~/.claude/commands/gsd/
cat ~/.claude/commands/gsd/execute-phase.md | head -20
```

Check:
- All GSD command files present
- Command files contain rendered paths (e.g., @~/.claude/get-shit-done/)
- Templates were processed correctly by existing copyWithPathReplacement()

**4. Test a command in Claude Code:**
```
/gsd:help
```

Should work without errors.

**5. Verify hooks execute:**

Restart Claude Code - SessionStart hook should run (check for update check message or behavior).

**6. Installation requirements verification:**

Confirm:
- INST-01 (platform selection): Phase 2 correctly hardcodes Claude Code, no multi-select yet (deferred to Phase 3)
- INST-02 (directories): ~/.claude/commands/gsd/ and ~/.claude/hooks/ exist
- INST-03 (collision): If you had previous GSD files, install handled them correctly
- INST-04 (orphaned cleanup): No orphaned files from previous versions
- INST-05 (env prompt): Working directory prompted correctly
- INST-06 (config backup): settings.json.backup exists
- INST-07 (hooks array): settings.json has proper hooks array structure

**That's it.** If install works, settings.json format is correct, commands execute, and hooks run, adapter is working with full backward compatibility.
  </how-to-verify>

  <resume-signal>
Reply with:

**approved** - Installation worked, backward compatibility confirmed, no issues

**issues: <description>** - Something broke, describe the problem
  </resume-signal>
</task>

</tasks>

<verification>
This plan IS the verification. Key checks:
- [ ] Installation completes without errors
- [ ] Runtime verification passes
- [ ] settings.json format matches v1.x (hooks array structure)
- [ ] Command files exist with rendered templates
- [ ] Commands execute in Claude Code
- [ ] Hooks execute on SessionStart
- [ ] Installation requirements (INST-01 through INST-07) satisfied
</verification>

<success_criteria>
- Fresh installation succeeds
- settings.json created correctly in v1.x format (backward compatible)
- Command files have templates rendered correctly
- Commands execute in Claude Code
- Hooks execute correctly
- Runtime verification confirms adapter methods executed
- Installation requirements validated (INST-01 through INST-07)
- No regressions from v1.x behavior
</success_criteria>

<output>
After human approval, create `.planning/phases/02-claude-code-adapter-backward-compatibility/02-03-SUMMARY.md`
</output>
