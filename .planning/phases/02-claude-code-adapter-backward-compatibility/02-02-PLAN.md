---
phase: 02-claude-code-adapter-backward-compatibility
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - bin/install.js
autonomous: true

must_haves:
  truths:
    - "install.js gets adapter via new ClaudeCodeAdapter()"
    - "install.js calls adapter.registerHook() instead of manual settings.json editing"
    - "install.js keeps ALL other existing logic unchanged"
    - "No adapter.registerCommand() calls - commands copied directly by install.js"
    - "Changes are ~20 lines maximum"
  artifacts:
    - path: "bin/install.js"
      provides: "Minimal adapter integration for hook registration"
      contains: "new ClaudeCodeAdapter()"
      min_lines: 550
  key_links:
    - from: "bin/install.js"
      to: "src/platform/adapters/claude-code.ts"
      via: "Direct instantiation and registerHook calls"
      pattern: "adapter\\.registerHook"
---

<objective>
Minimal install.js integration: Replace manual settings.json hook editing with adapter.registerHook() calls. Keep 95% of install.js unchanged - all directory creation, command copying, collision detection, orphaned cleanup, and template rendering stays exactly as-is.

Purpose: Prove adapter works without refactoring install.js.
Output: install.js with ~20 lines changed for hook registration only.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-CONTEXT.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-RESEARCH.md

# Adapter from Plan 01
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-01-SUMMARY.md

# File to modify
@bin/install.js
</context>

<tasks>

<task type="auto">
  <name>Minimal install.js integration - hook registration only (~20 lines changed)</name>
  <files>bin/install.js</files>
  <action>
Make MINIMAL changes to install.js - only replace manual settings.json hook editing:

**1. Add import at top (after existing requires):**
```javascript
const { ClaudeCodeAdapter } = require('../dist/platform');
```

**2. In install() function, create adapter instance:**

Find where install function starts (around line 240), add near beginning:
```javascript
const adapter = new ClaudeCodeAdapter();
```

**3. Replace manual hook registration:**

Find the section where settings.json hooks are manually added (around lines 375-397). Replace ONLY that section with:

```javascript
// Register hooks using adapter
await adapter.registerHook('SessionStart', path.join(hooksDir, 'gsd-check-update.js'));

if (shouldInstallStatusLine) {  // Use existing logic for deciding
  await adapter.registerHook('StatusLine', path.join(hooksDir, 'gsd-statusline.js'));
}
```

**4. Make install() async if not already:**

If install() is not async, change:
```javascript
function install(isGlobal) { ... }
```
to:
```javascript
async function install(isGlobal) { ... }
```

And update the caller to use await.

**CRITICAL - What NOT to change:**

- ❌ NO adapter.registerCommand() calls - commands stay copied by copyWithPathReplacement()
- ❌ NO adapter.getConfigDir() replacements - keep existing getInstallPaths() usage
- ❌ NO refactoring of directory creation - keep fs.mkdirSync calls
- ❌ NO refactoring of collision detection - keep existing logic
- ❌ NO refactoring of orphaned cleanup - keep existing cleanupOrphanedFiles()
- ❌ NO refactoring of backup logic - keep existing backup code
- ❌ NO refactoring of command copying - keep copyWithPathReplacement()
- ❌ NO refactoring of template rendering - keep existing implementation

**ONLY change: Replace manual settings.json hook editing with adapter.registerHook().**

This should be ~20 lines changed total (1 import, 1 adapter instantiation, ~10 lines replacing hook registration, async/await adjustments).
  </action>
  <verify>
- Adapter imported: `grep "ClaudeCodeAdapter" bin/install.js`
- Adapter instantiated: `grep "new ClaudeCodeAdapter()" bin/install.js`
- Adapter created successfully: `grep "const adapter = new ClaudeCodeAdapter()" bin/install.js`
- registerHook called: `grep "adapter.registerHook" bin/install.js | wc -l` (should be 2)
- No registerCommand: `grep "adapter.registerCommand" bin/install.js | wc -l` (should be 0)
- install is async: `grep "async function install" bin/install.js`
- Syntax valid: `node --check bin/install.js`
- TypeScript builds: `npm run build`
  </verify>
  <done>
install.js imports ClaudeCodeAdapter, creates adapter instance, calls adapter.registerHook() instead of manual settings.json editing, install() is async, ALL other logic unchanged (commands copied directly, no adapter.registerCommand calls, existing directory creation/collision/cleanup/template logic preserved), ~20 lines changed total.
  </done>
</task>

</tasks>

<verification>
After task completion:
- [ ] bin/install.js imports ClaudeCodeAdapter
- [ ] Adapter instantiated with new ClaudeCodeAdapter()
- [ ] adapter.registerHook() called for SessionStart and StatusLine
- [ ] NO adapter.registerCommand() calls (commands copied by existing code)
- [ ] install() function is async
- [ ] All other install.js logic unchanged (~95% of file)
- [ ] node --check passes
- [ ] npm run build succeeds
- [ ] Changes are minimal (~20 lines)
</verification>

<success_criteria>
- install.js uses adapter ONLY for hook registration
- Manual settings.json hook editing replaced with adapter.registerHook()
- NO adapter.registerCommand() calls - command copying stays in install.js
- 95% of install.js unchanged - all existing logic preserved
- Changes are minimal and focused (~20 lines)
- TypeScript compiles and JavaScript syntax is valid
</success_criteria>

<output>
After completion, create `.planning/phases/02-claude-code-adapter-backward-compatibility/02-02-SUMMARY.md`
</output>
