---
phase: 02-claude-code-adapter-backward-compatibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/platform/adapters/claude-code.ts
  - src/platform/index.ts
autonomous: true

must_haves:
  truths:
    - "ClaudeCodeAdapter implements ONLY paths, config read/write, and hook registration"
    - "All other methods (registerCommand, unregisterCommand, spawnAgent) are stubbed"
    - "Adapter is ~120-150 lines total"
    - "Path methods delegate to ClaudeCodePaths"
  artifacts:
    - path: "src/platform/adapters/claude-code.ts"
      provides: "Ultra-minimal ClaudeCodeAdapter"
      exports: ["ClaudeCodeAdapter"]
      min_lines: 120
      max_lines: 150
    - path: "src/platform/index.ts"
      provides: "Export ClaudeCodeAdapter"
      contains: "ClaudeCodeAdapter"
  key_links:
    - from: "src/platform/adapters/claude-code.ts"
      to: "src/platform/paths.ts"
      via: "Delegate path methods to ClaudeCodePaths"
      pattern: "this\\.paths\\."
---

<objective>
Create ultra-minimal ClaudeCodeAdapter implementing ONLY what Phase 2 needs: paths (delegate to ClaudeCodePaths), basic config read/write (fs.readFileSync/writeFileSync wrapper), and hook registration (modify settings.json hooks array). Everything else gets stubbed with "Not implemented in Phase 2" errors.

Purpose: Minimal adapter to unblock install.js integration without over-engineering.
Output: Single ~120-150 line TypeScript file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-CONTEXT.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-RESEARCH.md

# Interface and types
@src/platform/adapter.ts
@src/platform/paths.ts
@src/platform/types.ts
</context>

<tasks>

<task type="auto">
  <name>Create ultra-minimal ClaudeCodeAdapter (~120-150 lines)</name>
  <files>src/platform/adapters/claude-code.ts, src/platform/index.ts</files>
  <action>
Create src/platform/adapters/claude-code.ts implementing ONLY these methods:

**IMPLEMENT (3 categories, ~100 lines):**

1. **Path methods** - Pure delegation to ClaudeCodePaths:
```typescript
private paths: ClaudeCodePaths;
constructor() { this.paths = new ClaudeCodePaths(); }
getConfigDir(): string { return this.paths.getConfigDir(); }
getCommandsDir(): string { return this.paths.getCommandsDir(); }
getAgentsDir(): string { return this.paths.getAgentsDir(); }
getHooksDir(): string { return this.paths.getHooksDir(); }
```

2. **Config read/write** - Simple fs wrapper for settings.json:
```typescript
async readConfig(): Promise<Record<string, any>> {
  const settingsPath = path.join(this.getConfigDir(), 'settings.json');
  if (!fs.existsSync(settingsPath)) return {};
  return JSON.parse(fs.readFileSync(settingsPath, 'utf8'));
}

async writeConfig(config: Record<string, any>): Promise<void> {
  const settingsPath = path.join(this.getConfigDir(), 'settings.json');
  fs.writeFileSync(settingsPath, JSON.stringify(config, null, 2) + '\n');
}
```

3. **Hook registration** - Modify hooks array in settings.json:
```typescript
async registerHook(hookType: string, hookPath: string): Promise<void> {
  const config = await this.readConfig();
  if (!config.hooks) config.hooks = {};
  if (!config.hooks[hookType]) config.hooks[hookType] = [];

  // Simple append - no deduplication needed for fresh installs
  config.hooks[hookType].push({
    hooks: [{ type: 'command', command: hookPath }]
  });

  await this.writeConfig(config);
}
```

**STUB (5 methods, ~20 lines):**

All other PlatformAdapter interface methods throw "Not implemented in Phase 2":

```typescript
async registerCommand(): Promise<void> {
  throw new Error('registerCommand() not implemented in Phase 2 - install.js handles command copying');
}

async unregisterCommand(): Promise<void> {
  throw new Error('unregisterCommand() not implemented in Phase 2');
}

async unregisterHook(): Promise<void> {
  throw new Error('unregisterHook() not implemented in Phase 2');
}

async spawnAgent(): Promise<AgentInstance> {
  throw new Error('spawnAgent() not implemented in Phase 2 - deferred to Phase 4');
}

getCapabilities(): PlatformCapabilities {
  return {
    supportsParallelAgents: true,
    supportsStatusLine: true,
    supportsHooks: true
  };
}
```

**Update src/platform/index.ts:**

Add export:
```typescript
export { ClaudeCodeAdapter } from './adapters/claude-code';
```

**NO deep merge, NO backup logic, NO collision detection.** Keep it simple - install.js handles everything else.

Target: 120-150 lines total (including imports, comments).
  </action>
  <verify>
- TypeScript compiles: `npm run build`
- File exists and is small: `wc -l src/platform/adapters/claude-code.ts` (should be 120-150)
- Implements interface: `grep "implements PlatformAdapter" src/platform/adapters/claude-code.ts`
- Delegates paths: `grep "this.paths" src/platform/adapters/claude-code.ts | wc -l` (should be >= 4)
- Stubs present: `grep "not implemented in Phase 2" src/platform/adapters/claude-code.ts | wc -l` (should be >= 4)
- Exported: `grep "ClaudeCodeAdapter" src/platform/index.ts`
  </verify>
  <done>
ClaudeCodeAdapter exists at ~120-150 lines, implements ONLY paths (delegated), config read/write (basic fs wrapper), and hook registration (array modification), stubs everything else with clear error messages, exported from src/platform/index.ts, TypeScript compiles.
  </done>
</task>

</tasks>

<verification>
After task completion:
- [ ] src/platform/adapters/claude-code.ts is 120-150 lines (not 200-250)
- [ ] Implements ONLY: path delegation, config read/write, hook registration
- [ ] Stubs: registerCommand, unregisterCommand, unregisterHook, spawnAgent
- [ ] No deep merge, no backup, no collision detection
- [ ] TypeScript compiles without errors
- [ ] Exported from src/platform/index.ts
</verification>

<success_criteria>
- Ultra-minimal adapter: ~120-150 lines
- Path methods delegate to ClaudeCodePaths (4-5 one-liners)
- Config methods wrap fs.readFileSync/writeFileSync (simple JSON)
- Hook registration modifies settings.json array (basic append)
- All other methods stubbed with "Not implemented in Phase 2"
- No complexity - defer everything to install.js
- TypeScript compiles and exports correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-claude-code-adapter-backward-compatibility/02-01-SUMMARY.md`
</output>
