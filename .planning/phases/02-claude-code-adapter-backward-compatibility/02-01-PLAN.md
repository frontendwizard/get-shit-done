---
phase: 02-claude-code-adapter-backward-compatibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/platform/adapters/claude-code.ts
  - src/platform/index.ts
autonomous: true

must_haves:
  truths:
    - "ClaudeCodeAdapter implements needed PlatformAdapter methods (readConfig, writeConfig, mergeConfig, registerHook, registerCommand, getCapabilities)"
    - "Partial implementation accepted: spawnAgent, unregisterHook, unregisterCommand stubbed for Phase 4"
    - "Path resolution delegates to ClaudeCodePaths class"
    - "Config methods read/write settings.json with backup"
    - "Hook registration adds to settings.json hooks array"
    - "Command registration copies files to commands/gsd/ directory"
  artifacts:
    - path: "src/platform/adapters/claude-code.ts"
      provides: "ClaudeCodeAdapter class implementing PlatformAdapter (partial)"
      exports: ["ClaudeCodeAdapter"]
      min_lines: 200
    - path: "src/platform/index.ts"
      provides: "Export ClaudeCodeAdapter for use in install.js"
      contains: "ClaudeCodeAdapter"
  key_links:
    - from: "src/platform/adapters/claude-code.ts"
      to: "src/platform/paths.ts"
      via: "ClaudeCodePaths composition"
      pattern: "new ClaudeCodePaths\\(\\)"
    - from: "src/platform/adapters/claude-code.ts"
      to: "src/platform/adapter.ts"
      via: "PlatformAdapter interface implementation"
      pattern: "implements PlatformAdapter"
---

<objective>
Create a minimal viable ClaudeCodeAdapter that implements ONLY what's needed for backward compatibility in Phase 2. The adapter provides simple wrappers around basic file operations - no complex logic, no collision detection, no backup/merge complexity. Methods not needed yet (spawnAgent, unregisterHook, unregisterCommand) are explicitly stubbed for Phase 4.

Purpose: Enable adapter pattern with minimal scope - implement what we need now, defer the rest.
Output: Single TypeScript file implementing the adapter interface (partial implementation).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-CONTEXT.md
@.planning/phases/02-claude-code-adapter-backward-compatibility/02-RESEARCH.md

# Interface to implement
@src/platform/adapter.ts
@src/platform/paths.ts
@src/platform/types.ts

# Existing install.js logic (reference for behavior, DON'T extract complex logic)
@bin/install.js
</context>

<tasks>

<task type="auto">
  <name>Create minimal viable ClaudeCodeAdapter with Phase 4 stubs</name>
  <files>src/platform/adapters/claude-code.ts</files>
  <action>
Create new file src/platform/adapters/claude-code.ts implementing PlatformAdapter interface.

**MINIMAL VIABLE scope - implement ONLY what Phase 2 needs:**

**IMPLEMENT (needed for backward compatibility):**

1. **Path methods** - Delegate to ClaudeCodePaths (composition):
```typescript
private paths: ClaudeCodePaths;
getConfigDir(): string { return this.paths.getConfigDir(); }
getCommandsDir(): string { return this.paths.getCommandsDir(); }
getAgentsDir(): string { return this.paths.getAgentsDir(); }
getHooksDir(): string { return this.paths.getHooksDir(); }
```

2. **Config methods** - Basic JSON read/write:
- `readConfig()`: Read settings.json, parse JSON, return {} if not exists
- `writeConfig(config)`: Simple backup (copy to .backup), write JSON
- `mergeConfig(updates)`: Read, shallow merge with spread, write

3. **Hook registration** - Add entry to settings.json:
- `registerHook()`: Read config, append to hooks[hookType] array, write
- Keep it simple - just add array entries

4. **Command registration** - Basic file copy:
- `registerCommand()`: mkdir -p, then copyFile
- NO collision detection in adapter (install.js handles that)

5. **Capability methods** - Return true:
```typescript
getCapabilities(): PlatformCapabilities {
  return {
    supportsParallelAgents: true,
    supportsStatusLine: true,
    supportsHooks: true
  };
}
```

**STUB (not needed until Phase 4):**

These methods are NOT implemented in Phase 2. Add clear stubs with error messages:

```typescript
async spawnAgent(): Promise<AgentInstance> {
  throw new Error('spawnAgent() not implemented - deferred to Phase 4 (multi-platform support)');
}

async unregisterHook(): Promise<void> {
  throw new Error('unregisterHook() not implemented - deferred to Phase 4 (multi-platform support)');
}

async unregisterCommand(): Promise<void> {
  throw new Error('unregisterCommand() not implemented - deferred to Phase 4 (multi-platform support)');
}
```

**What NOT to include:**
- NO complex collision detection (install.js handles that)
- NO deep merge logic (use shallow spread, or simple recursive helper)
- NO orphaned file cleanup (install.js handles that)
- NO template rendering (install.js copyWithPathReplacement handles that)
- NO async conversion of install.js (keep install.js as-is)

**Simple backup helper:**
```typescript
private async backupFile(filePath: string): Promise<void> {
  if (fs.existsSync(filePath)) {
    await fs.promises.copyFile(filePath, `${filePath}.backup`);
  }
}
```

**Simple merge (use spread operator):**
```typescript
async mergeConfig(updates: Record<string, any>): Promise<void> {
  const existing = await this.readConfig();
  const merged = { ...existing, ...updates };
  await this.writeConfig(merged);
}
```

If you need deeper merge for hooks arrays, add a simple recursive helper (~10 lines).

**Target: ~200-250 lines.** With 3 stubbed methods, this is achievable.
  </action>
  <verify>
- TypeScript compiles: `npm run build`
- File exists: `ls src/platform/adapters/claude-code.ts`
- Exports ClaudeCodeAdapter: `grep "export class ClaudeCodeAdapter" src/platform/adapters/claude-code.ts`
- Implements interface: `grep "implements PlatformAdapter" src/platform/adapters/claude-code.ts`
- Implemented methods present: `grep -E "(readConfig|writeConfig|registerHook|registerCommand|getCapabilities)" src/platform/adapters/claude-code.ts | wc -l` (should be >= 5)
- Stubbed methods present: `grep -E "(spawnAgent|unregisterHook|unregisterCommand)" src/platform/adapters/claude-code.ts | wc -l` (should be >= 3)
- Stubs throw errors: `grep "Phase 4" src/platform/adapters/claude-code.ts | wc -l` (should be >= 3)
  </verify>
  <done>
ClaudeCodeAdapter class exists, implements needed PlatformAdapter methods (readConfig, writeConfig, mergeConfig, registerHook, registerCommand, getCapabilities), stubs Phase 4 methods (spawnAgent, unregisterHook, unregisterCommand) with clear error messages, compiles without errors, uses composition for paths, total ~200-250 lines (minimal viable).
  </done>
</task>

<task type="auto">
  <name>Export adapter from platform module</name>
  <files>src/platform/index.ts</files>
  <action>
Update src/platform/index.ts to export ClaudeCodeAdapter:

```typescript
// Add to existing exports
export { ClaudeCodeAdapter } from './adapters/claude-code';
```

This makes the adapter available for import in install.js and registry.

Verify the file compiles after adding export.
  </action>
  <verify>
- Export added: `grep "ClaudeCodeAdapter" src/platform/index.ts`
- TypeScript compiles: `npm run build`
- Compiled file exists: `ls dist/platform/adapters/claude-code.js`
- Can import: `node -e "const {ClaudeCodeAdapter} = require('./dist/platform'); console.log('OK');"`
  </verify>
  <done>
ClaudeCodeAdapter is exported from src/platform/index.ts and compiled to dist/.
  </done>
</task>

</tasks>

<verification>
After task completion:
- [ ] src/platform/adapters/claude-code.ts exists and implements PlatformAdapter
- [ ] Implemented methods: readConfig, writeConfig, mergeConfig, registerHook, registerCommand, getCapabilities
- [ ] Stubbed methods: spawnAgent, unregisterHook, unregisterCommand (with "Phase 4" error messages)
- [ ] TypeScript compilation succeeds
- [ ] ClaudeCodeAdapter exported from src/platform/index.ts
- [ ] Compiled output exists in dist/platform/adapters/
- [ ] Adapter is lean (~200-250 lines, minimal viable scope)
</verification>

<success_criteria>
- ClaudeCodeAdapter class implements needed PlatformAdapter methods (partial implementation accepted)
- Phase 4 methods (spawnAgent, unregisterHook, unregisterCommand) are stubbed with clear error messages
- Path methods delegate to ClaudeCodePaths (no duplication)
- Config methods handle settings.json with simple backup
- Hook registration adds array entries
- Command registration performs basic copy (no collision logic in adapter)
- Code is lean (~200-250 lines, minimal viable scope)
- TypeScript compiles without errors
- Ready for integration in install.js (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/02-claude-code-adapter-backward-compatibility/02-01-SUMMARY.md`
</output>
